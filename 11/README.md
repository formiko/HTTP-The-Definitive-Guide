# 第11章 客户端识别与cookie机制
本章讨论了一些服务器可以用来识别其交谈对象的技巧
## 11.1 个性化接触
* 本章将讨论下列用户识别机制
    * 承载用户身份信息的HTTP首部。
    * 客户端IP地址跟踪，通过用户的IP地址对其进行识别。
    * 用户登录，用认证方式来识别用户。
    * 胖URL，一种在URL中嵌入识别信息的技术。
    * cookie，一种功能强大且高效的持久身份识别技术。。
## 11.2 HTTP首部
* 承载用户相关信息的HTTP首部
    |首部名称|首部类型|描述|
    |-|-|-|
    |From|请求|用话的E-mail地址|
    |User-Agent|请求|用户的浏览器软件|
    |Referer|请求|用户是从这个页面上依照链接跳转过来的|
    |Authorization|请求|用户名和密码|
    |Client-IP|扩展（请求）|客户端的IP地址|
    |X-Forwarded-For|扩展（请求）|客户端的IP地址|
    |Cookie|扩展（请求）|服务器产生的ID标签|
* 关于From首部：很少有浏览器会发送From首部。实际上，From首部是由爬虫发的，方便网管联系爬虫负责人。
* 关于User-Agent首部：
    * 通常还包括操作系统的相关信息。
    * 并没有为识别特定的用户提供太多有意义的帮助。
* From、User-Agent和Referer首部都不足以实现可靠的识别。
## 11.3 客户端的IP地址
* 通过IP地址识别用户的条件：
    * 每个用户都有不同的IP地址
    * IP地址也很少会发生变化
    * Web服务器可以判断出每条请求的客户端IP地址
* 通常在HTTP首部并不提供客户端的IP地址，但Web服务器可以找到承载HTTP请求的TCP连接另一端的IP地址：比如，在Unix系统中，函数调用getpeername就可以返回发送端机器的客户端IP地址：
    ``` C
    status = getpeername(tcp_connection_socket,...);
    ```
* 使用客户端IP地址来识别用户的缺点：
    * 客户端IP地址描述的是所用的机器，而不是用户
    * 很多因特网服务提供商都会在用户登录时为其动态分配IP地址
    * 为了提高安全性，并对稀缺的地质资源进行管理，很多用户都是通过网络地址转换（Network Address Translation，NAT）防火墙来浏览网络内容的。这些NAT设备隐藏了防火墙后面那些实际客户端的IP地址，将实际的客户端IP地址转换成一个共享的防火墙IP地址（和不同的端口号）
    * HTTP代理和网关。Web服务器看到的将是代理服务器的IP地址，而不是客户端的。有些代理为了绕过这个问题会添加特殊的Client-IP或X-Forwarded-For扩展首部来保存原始的IP地址。
* 少数站点甚至将客户端IP地址作为一种安全特性使用，它们只向来自特定IP地址的用户提供文档。缺陷：
    * 因特网上IP地址太容易被欺骗（伪造）了。
    * 路径上如果有拦截代理也会破坏此方案
* [第14章](14)讨论了一些强大得多的特权文档访问控制策略。

## 11.4 用户登录
* 流程：
    1. 客户端向服务器发送一条请求
    2. 服务器不知道这个用户的身份，返回401 Login Required HTTP响应码，并添加 WWW-Authenticate首部，要求用户登录。这样浏览器（客户端）就会弹出一个登录对话框。
    3. 只要用户输入了用户名和密码，浏览器就会重复原来的请求。这次它会添加一个Authorization首部，说明用户和密码。